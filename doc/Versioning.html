<html>
<head><title>SilverKing Versioning</title>
<link href="style.css" rel="stylesheet" type="text/css">
</head>
<body>
<h1>SilverKing Versioning</h1>

<h2>Introduction</h2>

<p>
In addition to its key, each value stored in SilverKing has a version and a creation time associated with it. Versions may be supplied by users, or generated by SilverKing. Creation times are always generated by SilverKing at the time of value creation.
</p>

<h2>Details</h2>

<p>
Each namespace in SilverKing specifies how the version and creation time are used in <a href="javadocs/com/ms/silverking/cloud/dht/NamespaceOptions.html">NamespaceOptions</a>. For instance, some namespaces may specify that only a single value is ever associated with a key. Other namespaces may allow multiple values to be associated with a single key. In particular, each namespace specifies a <a href="javadocs/com/ms/silverking/cloud/dht/NamespaceVersionMode.html">NamespaceVersionMode</a> and a <a href="javadocs/com/ms/silverking/cloud/dht/RevisionMode.html">RevisionMode</a>. 
</p>

<p>
<a href="javadocs/com/ms/silverking/cloud/dht/NamespaceVersionMode.html">NamespaceVersionMode</a> specifies how versions for keys are supplied as follows:
<ul>
  <li>SINGLE_VERSION - Only a single version may be associated with the value. The version number is undefined and should not be used externally in this case.</li>
  <li>CLIENT_SPECIFIED - Multiple versions of a value may exist. The client must explicitly specify the version.</li>
  <li>SEQUENTIAL - Versions will be generated automatically from the positive integers.</li>
  <li>SYSTEM_TIME_MILLIS - Versions will be generated automatically using the system time in milliseconds.</li>
  <li>SYSTEM_TIME_NANOS - Versions will be generated automatically using the system time in nanoseconds.</li>
</ul>
</p>

<p>
A revision is the creation of a value with a version <= the latest stored version (creation time is always monotonically increasing.) <a href="javadocs/com/ms/silverking/cloud/dht/RevisionMode.html">RevisionMode</a> controls whether or not a given namespace allows revisions using the value of either NO_REVISIONS or UNRESTRICTED_REVISIONS.
</p>

<p>
A SINGLE_VERSION namespace is also "write once" iff its revision mode is NO_REVISIONS; otherwise, while there is only a single version associated with any one key, different values may be associated with a key at different creation times.
</p>

<p>
Retrieval operations may specify which of the potentially several values associated with a given key are retrieved using a VersionConstraint. A VersionConstraint is specified with the following attributes:
<ul>
  <li>min - The minimum acceptable version inclusive.</li>
  <li>max - The maximum acceptable version inclusive.</li>
  <li>mode - When multiple versions match, selects either the LEAST or GREATEST of these versions.</li>
  <li>maxCreationTime - The maximum creation time allowed (inclusive.) (A minimum creation time is not specified since value with the maximum matching creation time is always retrieved.)</li>
</ul>
</p>

<hr>
<h2>Example</h2>

<p>
As an example of how two-dimensional versioning works in SilverKing, consider the
following example. This example considers multiple values/versions stored to
a single key; it applies for any NamespaceVersionMode other than SINGLE_VERSION, 
and a RevisionMode of UNRESTRICTED_REVISIONS.
By definition, the creation/storage time is always increasing.
Value storage is shown using green circles. Value invalidation (deletion) is shown
using red circles. 
</p>
<p>
In this example, a client initially associates 7 monotonically increasing versions
with this key. At time 5, the client invalidates version 3. At time 6, the client
invalidates version 7.5. 
At time 7, the client revises version 5.
At time 8, the client stores version 10.
</p>
<p>
The subsequent examples show how clients can use VersionConstraints to control
what version is returned.
The version constraint used is shown on the upper right hand corner of
each example. 
For example, Read [3,10],4,Greatest specifies
a VersionConstraint with min version of 3, max version of 10,
maxCreationTime of 10, and a mode of GREATEST.
In these examples, the arrow on the x-axis graphically illustrates the maxCreationTime used.
The bracket on the y-axis graphically illustrates the min and max versions used. 
The large green circle shows the actual value returned.
</p>

<table class="image" align="center">
<caption align="bottom"><b>Figure 1:</b> Version Example Base</caption>
<tr><td><img src="VersionExampleBase.png" alt="Version Example Base"/></td></tr>
</table>

<hr>
<p>
</p>

<table class="image" align="center">
<caption align="bottom"><b>Figure 2:</b> Version Example, Read [3,10],4,Greatest</caption>
<tr><td><img src="VersionExampleRead_3_10_4_Greatest.png" alt="Version Example, Read [3,10],4,Greatest"/></td></tr>
</table>

<hr>
<table class="image" align="center">
<caption align="bottom"><b>Figure 3:</b> Version Example, Read [3,10],4,Least</caption>
<tr><td><img src="VersionExampleRead_3_10_4_Least.png" alt="Version Example, Read [3,10],4,Least"/></td></tr>
</table>

<hr>
<table class="image" align="center">
<caption align="bottom"><b>Figure 4:</b> Version Example, Read [3,10],10,Greatest</caption>
<tr><td><img src="VersionExampleRead_3_10_10_Greatest.png" alt="Version Example, Read [3,10],10,Greatest"/></td></tr>
</table>

<hr>
<table class="image" align="center">
<caption align="bottom"><b>Figure 5:</b> Version Example, Read [3,10],10,Least</caption>
<tr><td><img src="VersionExampleRead_3_10_10_Least.png" alt="Version Example, Read [3,10],10,Least"/></td></tr>
</table>

<hr>
<table class="image" align="center">
<caption align="bottom"><b>Figure 6:</b> Version Example, Read [3,8],10,Greatest</caption>
<tr><td><img src="VersionExampleRead_3_8_10_Greatest.png" alt="Version Example, Read [3,8],10,Greatest"/></td></tr>
</table>

</body>
</html>
